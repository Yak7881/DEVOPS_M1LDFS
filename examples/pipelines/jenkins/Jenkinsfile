// =============================================================================
// ğŸ“˜ Jenkinsfile â€” Pipeline Jenkins de dÃ©monstration
// =============================================================================
//
// Ce fichier dÃ©crit un pipeline Jenkins simple avec 3 Ã©tapes (stages).
// Jenkins lit ce fichier et exÃ©cute les Ã©tapes dans l'ordre.
//
// ğŸ’¡ Tu n'as PAS besoin d'installer Jenkins pour comprendre ce fichier.
//    Lis les commentaires, c'est un support d'apprentissage.
//
// Format : Groovy (un langage de programmation, pas YAML)
// =============================================================================

pipeline {
    // "agent any" = exÃ©cuter sur n'importe quelle machine Jenkins disponible.
    // C'est l'Ã©quivalent de "runs-on: ubuntu-latest" dans GitHub Actions.
    agent any

    // "stages" = la liste des Ã©tapes du pipeline, dans l'ordre.
    stages {

        // ---------------------------------------------------------------
        // Ã‰TAPE 1 : Prepare (PrÃ©paration)
        // ---------------------------------------------------------------
        // But : rÃ©cupÃ©rer le code et vÃ©rifier que l'environnement est prÃªt.
        stage('Prepare') {
            steps {
                echo 'ğŸ”§ Ã‰tape 1 : PrÃ©paration'
                echo 'RÃ©cupÃ©ration du code source...'

                // "checkout scm" = rÃ©cupÃ©rer le code du dÃ©pÃ´t.
                // C'est l'Ã©quivalent de "actions/checkout@v4" dans GitHub Actions.
                checkout scm

                echo 'Code rÃ©cupÃ©rÃ© avec succÃ¨s.'
            }
        }

        // ---------------------------------------------------------------
        // Ã‰TAPE 2 : Check (VÃ©rification)
        // ---------------------------------------------------------------
        // But : vÃ©rifier que le code est correct (tests, format, etc.)
        stage('Check') {
            steps {
                echo 'ğŸ” Ã‰tape 2 : VÃ©rification'

                // "sh" = exÃ©cuter une commande shell (comme "run" dans GitHub Actions)
                sh 'echo "VÃ©rification de la structure du projet..."'
                sh 'test -f README.md && echo "âœ… README.md trouvÃ©" || echo "âŒ README.md manquant"'
                sh 'echo "Lancement des tests (simulÃ©)..."'
                sh 'echo "Tests OK â€” 0 erreur trouvÃ©e."'

                echo 'Toutes les vÃ©rifications sont passÃ©es.'
            }
        }

        // ---------------------------------------------------------------
        // Ã‰TAPE 3 : Package (Empaquetage)
        // ---------------------------------------------------------------
        // But : prÃ©parer le livrable (ex : crÃ©er un ZIP, un conteneur, etc.)
        stage('Package') {
            steps {
                echo 'ğŸ“¦ Ã‰tape 3 : Empaquetage'

                sh 'echo "CrÃ©ation du package de livraison (simulÃ©)..."'
                sh 'echo "Package crÃ©Ã© : devops-rooms-v1.0.0.tar.gz"'

                echo 'Pipeline terminÃ© avec succÃ¨s ! ğŸ‰'
            }
        }
    }

    // "post" = actions Ã  faire aprÃ¨s le pipeline (succÃ¨s ou Ã©chec)
    post {
        success {
            echo 'âœ… Pipeline rÃ©ussi â€” tout est bon !'
        }
        failure {
            echo 'âŒ Pipeline Ã©chouÃ© â€” vÃ©rifie les logs ci-dessus.'
        }
    }
}

// =============================================================================
// ğŸ“Œ RÃ‰SUMÃ‰
//
// Ce Jenkinsfile fait 3 choses :
// 1. Prepare : rÃ©cupÃ©rer le code
// 2. Check   : vÃ©rifier que tout est correct
// 3. Package : prÃ©parer le livrable
//
// Si une Ã©tape Ã©choue, le pipeline s'arrÃªte et affiche un message d'erreur.
//
// ğŸ”— Comparaison avec GitHub Actions :
//    - "agent any"    â†’  "runs-on: ubuntu-latest"
//    - "stage"        â†’  une Ã©tape dans "steps"
//    - "sh"           â†’  "run"
//    - "checkout scm" â†’  "actions/checkout@v4"
//
// ğŸ”— Voir aussi :
//    - examples/pipelines/explain/pipeline-step-by-step.md
//    - docs/pipelines-cheatsheet.md
// =============================================================================
